define(["jquery","ko","app"],function(n,t,r){var u={};return u.version="1.0",u.cookie=function(n,t,i){var f,r,e,o,u,s;if(typeof t!="undefined"){i=i||{};t===null&&(t="",i.expires=-1);f="";i.expires&&(typeof i.expires=="number"||i.expires.toUTCString)&&(typeof i.expires=="number"?(r=new Date,r.setTime(r.getTime()+i.expires*864e5)):r=i.expires,f="; expires="+r.toUTCString());var h=i.path?"; path="+i.path:"; path=/",c=i.domain?"; domain="+i.domain:"",l=i.secure?"; secure":"";document.cookie=[n,"=",encodeURIComponent(t),f,h,c,l].join("")}else{if(e="",document.cookie&&document.cookie!=="")for(o=document.cookie.split(";"),u=0;u<o.length;u++)if(s=o[u].trim(),s.substring(0,n.length+1)===n+"="){e=decodeURIComponent(s.substring(n.length+1));break}return e}},u.user={set:function(t){return n.Deferred(function(n){u.cookie("zdy_user",JSON.stringify(t),{expires:1});n.resolve()}).promise()},get:function(){var n=u.cookie("zdy_user");return n!==undefined?JSON.parse(n):undefined}},u.token={set:function(t){return n.Deferred(function(n){u.cookie("zdy_token",t,{expires:1});n.resolve()}).promise()},get:function(){return"Bearer "+u.cookie("zdy_token")}},u.dictionary={getItem:function(n,t,i){var r=undefined,u;if(n!==null&&n!==undefined&&n!=="")for(u=0;u<t.length;u++)if(t[u].Value.toLowerCase()===n.toLowerCase()){r=t[u];break}return r===undefined||!i||(r.Index=t.indexOf(r)),r},getText:function(n,t){var i=u.dictionary.getItem(n,t);return i!==undefined?i.Name:""}},u.viewmodel=function(){var i=function(){this.options=function(i){if(this.model.call(this,i),i.fields&&n.isArray(i.fields)){for(var r=0;r<i.fields.length;r++)this[i.fields[r].field]=i.fields[r].value;this.fields=JSON.parse(t.toJSON(i.fields))}return this};this.reset=function(){for(var n=0;n<this.fields.length;n++)this[this.fields[n].field](this.fields[n].value)};this.getInstance=function(){return this};this.import=function(n){return n.call(this),this};this.bind=function(i){var r,u;if(this.modelName=i,r=i===undefined?n("body"):n("[data-model='"+i+"']"),r.length>0)for(u=0;u<r.length;u++)t.applyBindings(this,r[u]),n(r[u]).fadeIn();else throw new Error("Could not find 'data-model'!");return this};this.assignment=function(i){var u,f,r;i=JSON.parse(t.toJSON(i));for(u in i.fields)f=i.fields[u].field,r=i[f],i.fields[u].value=n.isArray(r)?r.join(","):r;return i};this.valid=function(){return u.validate(n("[data-model='"+this.modelName+"']"))};this.dictionary=undefined;this.dic=function(){if(typeof arguments[0]=="object")this.dictionary=arguments[0];else{if(typeof arguments[0]=="string"){if(arguments.length<2)return"";var n=arguments[0],t=arguments[1],i=!!arguments[2];return i?u.dictionary.getItem(t+"",this.dictionary[n],i):u.dictionary.getText(t+"",this.dictionary[n])}return""}};this.goto=function(t,i){var r=n(i.target).data("url");r!==undefined&&u.gotoPage(r)}},r=function(){var t=this;this.model=function(i){this.fields=i.fields;this.dataAddUrl=i.dataAddUrl;this.add=function(){if(!u.validate(n("[data-model='"+t.modelName+"']")))return n.Deferred(function(n){n.resolve(!1)}).promise();if(t.beforeAdd&&t.beforeAdd.call(arguments)===!1)return n.Deferred(function(n){n.resolve(!1)}).promise();var i=t.assignment(t);return u.ajaxPost(this.dataAddUrl,i).done(function(n){u.toastr.success("新增操作成功");t.afterAdd&&t.afterAdd(n.Data,i)})};this.dataUpdateUrl=i.dataUpdateUrl;this.update=function(){if(!u.validate(n("[data-model='"+t.modelName+"']")))return n.Deferred(function(n){n.resolve(!1)}).promise();if(t.beforeUpdate&&t.beforeUpdate.call(arguments)===!1)return n.Deferred(function(n){n.resolve(!1)}).promise();var i=t.assignment(t);return u.ajaxPost(t.dataUpdateUrl,i).done(function(n){u.toastr.success("修改操作成功");t.afterUpdate&&t.afterUpdate(n.Data,i)})};this.dataDeleteUrl=i.dataDeleteUrl;this.delete=function(){return t.beforeDelete&&t.beforeDelete.call(arguments)===!1?n.Deferred(function(n){n.resolve(!1)}).promise():u.confirm("确认要删除这条数据？").done(function(){var n=t.assignment(t);return u.ajaxPost(t.dataDeleteUrl,n).done(function(i){u.toastr.success("删除操作成功");t.afterDelete&&t.afterDelete(i.Data,n)})})}};this.load=function(){function n(n){for(var i in n)t[i]&&t[i](n[i]);t.afterLoad&&t.afterLoad(n)}var i,r,f;return t.beforeLoad&&t.beforeLoad.call(arguments)===!1?this:(typeof arguments[0]=="object"?(i=arguments[0],n(i)):typeof arguments[0]=="string"&&(r=arguments[0],f=arguments[1],u.ajaxPost(r,f).done(function(t){var i=t.Data;n(i)})),this)};this.refresh=function(){t.reset()};u.viewmodel.modelBase.call(this)},f=function(){var i=this;this.model=function(r){this.recordSet=t.observableArray();this.orderField=t.observable(r.defaultOrderBy);this.isAsc=t.observable(r.isAsc||!1);this.count=t.observable();this.totalPages=t.observable();this.pageNumbers=t.observableArray();this.pageSize=t.observable(r.pageSize||20);this.pageSizeStart=t.observable();this.pageSizeEnd=t.observable();this.pageIndex=t.observable(1);this.showStartPagerDot=t.observable(!1);this.showEndPagerDot=t.observable(!1);this.pagerCount=8;this.headers=t.observableArray(r.headers);this.dataQueryUrl=r.dataQueryUrl;this.fields=r.fields;this.search=function(){if(this.beforeSearch&&this.beforeSearch.call(arguments)===!1)return n.Deferred(function(n){n.resolve(!1)}).promise();var t=this.assignment(i);return u.ajaxPost(this.dataQueryUrl,{PageIndex:t.pageIndex,PageSize:t.pageSize,OrderField:t.orderField,IsAsc:t.isAsc,Fields:t.fields}).done(function(n){i.recordSet(n.Data.Item1);i.count(n.Data.Item2);i.resetPageNumbders();i.afterSearch&&i.afterSearch(n.Data,t)})};this.resetPageNumbders=function(){var t,n,r;for(i.totalPages(Math.ceil(i.count()/i.pageSize())),i.pageNumbers.removeAll(),t=1,n=i.pagerCount,i.pageIndex()>=i.pagerCount?(t=i.pageIndex()-Math.floor(i.pagerCount/2),i.showStartPagerDot(!0)):i.showStartPagerDot(!1),n=t+i.pagerCount-1,n>i.totalPages()?(n=i.totalPages(),i.showEndPagerDot(!1)):i.showEndPagerDot(!0),r=t;r<=n;r++)i.pageNumbers.push(r);i.pageSizeStart((i.pageIndex()-1)*i.pageSize()+1);i.pageSizeEnd(i.pageIndex()*i.pageSize()>i.count()?i.count():i.pageIndex()*i.pageSize())};this.sort=function(n){i.orderField()===n.field&&i.isAsc(!i.isAsc());i.orderField(n.field);i.pageIndex(1);i.search()};this.turnPage=function(n){i.pageIndex(n);i.search()};this.firstPage=function(){i.turnPage(1)};this.lastPage=function(){i.turnPage(i.totalPages())};this.prevPage=function(){i.pageIndex()>1&&i.turnPage(i.pageIndex()-1)};this.nextPage=function(){i.pageIndex()<i.totalPages()&&i.turnPage(i.pageIndex()+1)};this.selectField=r.selectField||"Id";this.isSelectAll=t.pureComputed(function(){var n=i.recordSet().map(function(n){return n[i.selectField]}),t=i.selectData(),r=Array.intersect(n,t),u=Array.minus(n,r);return u.length===0},this);this.selectAll=function(){var n=i.recordSet().map(function(n){return n[i.selectField]}),t=i.selectData(),u=i.isSelectAll(),r=[];r=u?Array.minus(n,t):Array.union(n,t);i.selectData(r)};this.selectData=t.observableArray()};this.load=function(){return i.beforeLoad&&i.beforeLoad.call(arguments)===!1?this:(this.search().done(function(n){i.afterLoad&&i.afterLoad(n.Data)}),this)};this.refresh=function(){i.firstPage()};u.viewmodel.modelBase.call(this)},e=function(){var i=this;this.model=function(r){this.rowFields=r.rowFields||function(){};this.addRow=function(){if(typeof i.rowFields=="function"){var n=new i.rowFields;n["new"]=!0;this.recordSet.unshift(n)}else throw new Error("'rowFields' must be constructor;like this  function () { this.fields1 = defaultvalue1 , this.fields2 = defaultvalue2 }");};this.dataAddUrl=r.dataAddUrl;this.add=function(r,f){if(!u.validate(n(f.toElement).closest("tr.editable-editrow"))||i.beforeAdd&&i.beforeAdd.call(this,r,f)===!1)return!1;var e=t.toJSON(r);u.ajaxPost(i.dataAddUrl,e).done(function(n){i.edited(r,f);i.search();i.afterAdd&&i.afterAdd(JSON.parse(e),n)})};this.dataUpdateUrl=r.dataUpdateUrl;this.update=function(r,f){if(!u.validate(n(f.toElement).closest("tr.editable-editrow"))||i.beforeUpdate&&i.beforeUpdate.call(this,r,f)===!1)return!1;var e=t.toJSON(r);u.ajaxPost(i.dataUpdateUrl,e).done(function(n){i.edited(r,f);i.search();i.afterUpdate&&i.afterUpdate(JSON.parse(e),n)})};this.dataDeleteUrl=r.dataDeleteUrl;this.delete=function(n){u.confirm("确认要删除这条数据？",function(){if(i.beforeDelete&&i.beforeDelete.call(this,n,context)===!1)return!1;if(n["new"])i.recordSet.remove(n),u.toastr.success("删除成功！"),i.afterDelete&&i.afterDelete(JSON.parse(r),rst);else{var r=t.toJSON(n);u.ajaxPost(i.dataDeleteUrl,r).done(function(t){i.recordSet.remove(n);u.toastr.success("删除成功！");i.afterDelete&&i.afterDelete(JSON.parse(r),t)})}})};this.allSubmitUrl=r.allSubmitUrl;this.allSubmit=function(){if(!u.validate(n("[data-model="+this.modelName+"]"))||i.beforeAllSubmit&&i.beforeAllSubmit.call(this,data,context)===!1)return!1;var r=t.toJSON(i);u.ajaxPost(i.allSubmitUrl,r).done(function(n){i.allSubmited&&i.allSubmited(JSON.parse(r),n)})};this.editing=function(t,i){if(i.target.nodeName.toLowerCase()==="a"){var r=n(i.toElement).closest("tr.editable-datarow");r.hide();r.next().show()}};this.edited=function(t,i){if(i.target.nodeName.toLowerCase()==="a"){var r=n(i.toElement).closest("tr.editable-editrow");r.hide();r.prev().show()}};u.viewmodel.table.model.call(this)};this.load=function(){return i.beforeLoad&&i.beforeLoad.call(arguments)===!1?n.Deferred(function(n){n.resolve(!1)}).promise():this.search().done(function(){i.afterAdd&&i.afterAdd(rst.Data)})};u.viewmodel.modelBase.call(this)};return{modelBase:i,form:r,table:f,editTable:e}}(),u.querymethod={equal:0,lessThan:1,greaterThan:2,lessThanOrEqual:3,greaterThanOrEqual:4,like:6,"in":7,notEqual:9,startsWith:10,endsWith:11,contains:12,stdIn:13},u.module=function(){return new u.viewmodel.modelBase},u.form=function(){return new u.viewmodel.form},u.table=function(){return new u.viewmodel.table},u.editTable=function(){return new u.viewmodel.editTable},u.cache={},u.createCache=function(t){return function(i,r){return u.cache[i]||(u.cache[i]=n.Deferred(function(n){t(n,i)}).promise()),u.cache[i].done(r)}},u.ajaxCache=u.createCache(function(t,i){n.ajax({url:i,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(n){n.setRequestHeader("Token",u.token.get());n.setRequestHeader("SessionID",u.session.get())},success:t.resolve,error:t.reject})}),u.aop={before:function(n,t,i){var r=n[t];return n[t]=function(){i.apply(this,arguments);r.apply(n,arguments)},n},after:function(n,t,i){var r=n[t];return n[t]=function(){return r.apply(n,arguments),i.apply(this,arguments),n},n},around:function(n,t,i){var r=n[t];return n[t]=function(){return i.apply(this,arguments),r.apply(n,arguments),i.apply(this,arguments),n},n}},u.validate=function(){var r={required:"必须填写该字段",remote:"请修正该字段",email:"请输入正确格式的电子邮件",url:"请输入合法的网址",date:"请输入合法的日期",dateISO:"请输入合法的日期 (ISO).",number:"请输入合法的数字",digits:"只能输入大于0的整数",ints:"只能输入整数",creditcard:"请输入合法的信用卡号",equalTo:"请再次输入相同的值",accept:"请输入拥有合法后缀名的字符串",year:"请输入正确的4位数年份",maxlength:"长度必须是小于等于 {0}",minlength:"长度必须是大于等于 {0}",rangelength:"长度必须介于 {0} 和 {1} 之间",range:"请输入一个介于 {0} 和 {1} 之间的值",max:"请输入一个最大为 {0} 的值",min:"请输入一个最小为 {0} 的值",ip:"请输入合法的IP地址",cn:"只能输入中文",en:"只能输入英文",loginName:"只能输入数字、26个英文字母或者下划线",mobile:"请输入正确的手机号码",phone:"请输入正确的电话号码"},t={required:function(t){return n.isArray(t)?t.length>0:n.trim(t).length>0},email:function(n){return this.required(n)?/^\S+@\S+\.\S{2,}$/.test(n):""},url:function(n){return this.required(n)?/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(n):""},date:function(n){return this.required(n)?!/Invalid|NaN/.test(new Date(n).toString()):""},dateISO:function(n){return this.required(n)?/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(n):""},number:function(n){return this.required(n)?/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(n):""},digits:function(n){return this.required(n)?/^\d+$/.test(n):""},creditcard:function(n){var i,f;if(this.required(n)){if(/[^0-9 \-]+/.test(n))return!1;var u=0,t=0,r=!1;for(n=n.replace(/\D/g,""),i=n.length-1;i>=0;i--)f=n.charAt(i),t=parseInt(f,10),r&&(t*=2)>9&&(t-=9),u+=t,r=!r;return u%10==0}return""},minlength:function(t,i){if(this.required(t)){var r=n.isArray(t)?t.length:t.toString().trim().length;return r>=i}return""},maxlength:function(t,i){if(this.required(t)){var r=n.isArray(t)?t.length:t.toString().trim().length;return r<=i}return""},rangelength:function(t,i){if(this.required(t)){var r=n.isArray(t)?t.length:t.toString().trim().length;return r>=i[0]&&r<=i[1]}return""},min:function(n,t){return this.required(n)?n>=t:""},max:function(n,t){return this.required(n)?n<=t:""},range:function(n,t){return this.required(n)?n>=t[0]&&n<=t[1]:""},equalTo:function(t,i){if(this.required(t)){var r=n(i);return t===r.val()}return""},remote:function(t,i){if(this.required(t)){var r={};return r.data=t,n.ajax({"async":!1,type:"POST",url:i,dataType:"json",data:r,success:function(n){n=n}}),!1}return""},year:function(n){if(this.required(n))n.isPositiveInteger()?thisVal.length!==4&&(rtn=dataRule[i]):rtn=dataRule[i];else return""},ip:function(n){return this.required(n)?"/^(d+).(d+).(d+).(d+)$/g".test(n)&&RegExp.$1<256&&RegExp.$2<256&&RegExp.$3<256&&RegExp.$4<256?!0:!1:""},cn:function(n){return this.required(n)?/^[\u4e00-\u9fa5]*$/.test(n):""},en:function(n){return this.required(n)?/^[a-zA-Z]*$/.test(n):""},loginName:function(n){return this.required(n)?/^\w*$/.test(n):""},mobile:function(n){return n.length===11&&/^1[3|4|5|7|8]\d{9}$/.test(n)},phone:function(n){return/^0\d{2,3}-?\d{7,8}$/.test(n)||/^\d{7,8}$/.test(n)}},f=function(t){var r,i,u;return t.is("span")||t.is("label")?t.html().trim():(r=t.attr("type"),i=t.val(),r==="radio"||r==="checkbox")?(u=[],n("input[name='"+t.attr("name")+"']:checked").each(function(){u.push(n(this).val())}),u):typeof i=="string"?i.replace(/\r/g,""):i},e=function(n){var s=n.attr("data-rule"),i,h,e,o;if(s===undefined||s==="")return"";var u=s.split(","),l=f(n),c="";for(i=0;i<u.length;i++){if(u[i].split(":").length>1)if(h=u[i].split(":")[0],u[i].indexOf("[")!==-1&&u[i].indexOf("]")!==-1){if(u[i].indexOf("|")===-1)throw Error("多个参数必须用[]将数据扩起，并且用|分隔");e=u[i].toString().replace("[","").replace("]","").split("|")}else e=u[i].split(":")[1];else h=u[i];for(o in t)h===o&&t[o](l,e)===!1&&(c=String.format(r[o],e))}return c},o=function(t,i){n(t).closest("div.form-group").addClass("has-error");var r=n("<span class='help-block help-block-error'>"+i+"<\/span>");s(r,t)},s=function(n,t){t.closest(".form-group").find(".help-block-error").length===0&&(t.is(":checkbox")?n.insertAfter(t.closest(".md-checkbox-list, .md-checkbox-inline, .checkbox-list, .checkbox-inline")):t.is(":radio")?n.insertAfter(t.closest(".md-radio-list, .md-radio-inline, .radio-list,.radio-inline")):n.insertAfter(t))},h=function(){n("div.form-group").each(function(){n(this).removeClass("has-error");n(this).find(".help-block-error").remove()})};return function(t){var r=this,i;return t.length===0?!1:(h(),i=!0,t.find("[data-rule]").each(function(){n(this).removeClass("error");var t=e(n(this));t!==""&&(i=!1,o(n(this),t))}),i||u.toastr.error("待提交的数据中有一些错误，请检查！"),i)}}(),u.ajaxBaseUrl="/api/v1/",u.ajaxGet=function(t){return n.ajax({url:u.ajaxBaseUrl+t,dataType:"json",type:"GET",beforeSend:function(n){n.setRequestHeader("Authorization",u.token.get());u.showLoading()},complete:function(){u.hideLoading()},error:u.ajaxError})},u.ajaxPost=function(t,i){return n.ajax({url:u.ajaxBaseUrl+t,dataType:"json",type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:i,beforeSend:function(n){n.setRequestHeader("Authorization",u.token.get());u.showLoading()},complete:function(){u.hideLoading()},error:u.ajaxError})},u.ajaxPostSilent=function(t,i){return n.ajax({url:u.ajaxBaseUrl+t,dataType:"json",type:"POST",beforeSend:function(n){n.setRequestHeader("Authorization",u.token.get())},contentType:"application/x-www-form-urlencoded; charset=utf-8",data:i})},u.ajaxError=function(n){var t=n.status;switch(t){case 401:u.alert.error("您的登录凭证过期,请重新登录").done(function(){typeof gotoIndex=="function"?window.gotoIndex():window.parent.gotoIndex()});break;case 403:u.toastr.error("未获得权限，请联系管理员");break;case 404:u.alert.error("请求未找到",function(){window.location.reload()});break;case 500:u.toastr.error("内部服务器错误");break;case 510:u.toastr.error(n.responseJSON.Message);break;default:u.toastr.error(String.format("{0} Code:{1}","未知错误",t))}},u.upload=function(t){var i,r;if(t=Object.assign({files:undefined,type:undefined,businessId:undefined,input:undefined,e:undefined},t),t.files===undefined&&(t.files=n(t.input).prop("files")),t.files.length>0){for(i=new FormData,r=0;r<t.files.length;r++)i.append(t.files[r].name,t.files[r]);return i.append("type",t.type),i.append("businessId",t.businessId||0),n.ajax({url:u.ajaxBaseUrl+"upload",type:"POST",cache:!1,data:i,processData:!1,contentType:!1,dataType:"json",beforeSend:function(n){n.setRequestHeader("Authorization",u.token.get());u.showLoading()},complete:function(){u.hideLoading()},error:u.ajaxError}).done(function(i){i.IsSuccess===!0?u.toastr.success("上传成功"):u.toastr.error("上传失败");t.input&&n(t.input).val("")})}},u.showLoading=function(){r.startPageLoading()},u.hideLoading=function(){r.stopPageLoading()},u.alert={error:function(n){return window.parent.alert?window.parent.alert.error(n):r.sweetAlert({text:n,type:"error",confirmButtonClass:"btn-danger"})},warning:function(n){return window.parent.alert?window.parent.alert.error(n):r.sweetAlert({text:n,type:"warning",confirmButtonClass:"btn-danger"})},success:function(n){return window.parent.alert?window.parent.alert.error(n):r.sweetAlert({text:n,type:"success",confirmButtonClass:"btn-danger"})},info:function(n){return window.parent.alert?window.parent.alert.error(n):r.sweetAlert({text:n,type:"info",confirmButtonClass:"btn-danger"})}},u.toastr={error:function(n){window.parent.toastr?window.parent.toastr.error(n):r.showToastr("error",n,"错误提示")},warning:function(n){window.parent.toastr?window.parent.toastr.warning(n):r.showToastr("warning",n,"警告提示")},success:function(n){window.parent.toastr?window.parent.toastr.success(n):r.showToastr("success",n,"成功提示")},info:function(n){window.parent.toastr?window.parent.toastr.info(n):r.showToastr("warning",n,"信息提示")}},u.confirm=function(n){return window.parent.confirm?window.parent.confirm(n):r.sweetAlert({text:n,allowOutsideClick:!0,showConfirmButton:!0,showCancelButton:!0,confirmButtonClass:"btn-info",cancelButtonClass:"btn-danger",type:"warning",confirmButtonText:"确认",cancelButtonText:"取消"})},u.showModal=function(t){return n.Deferred(function(i){n("#"+t).modal({backdrop:"static",keyboard:!1}).on("shown.bs.modal",function(){i.resolve()})}).promise()},u.hideModal=function(t){return n.Deferred(function(i){n("#"+t).modal("hide").on("hidden.bs.modal",function(){i.resolve()})}).promise()},u.openWindow=function(n){typeof openWindow=="function"?window.openWindow(n):window.parent.openWindow(n)},u.gotoPage=function(n){typeof gotoPage=="function"?window.gotoPage(n):window.parent.gotoPage(n)},u.closePage=function(n){n===undefined&&(n=window.location.pathname,window.location.search!==undefined&&window.location.search!==""&&(n+=window.location.search));typeof gotoPage=="function"?window.closePage(n):window.parent.closePage(n)},u.replacePage=function(n){u.closePage();u.gotoPage(n)},u.colors=["blue          ","blue-hoki     ","blue-steel    ","blue-madison  ","blue-chambray ","blue-ebonyclay","green           ","green-meadow    ","green-seagreen  ","green-turquoise ","green-haze      ","green-jungle    ","red             ","red-pink        ","red-sunglo      ","red-intense     ","red-thunderbird ","red-flamingo    ","yellow            ","yellow-gold       ","yellow-casablanca ","yellow-crusta     ","yellow-lemon      ","yellow-saffron    ","purple          ","purple-plum     ","purple-medium   ","purple-studio   ","purple-wisteria ","purple-seance   "],u.tools={bytesToSize:function(n){if(n===0)return"0 B";var t=1024;return sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(n)/Math.log(t)),(n/Math.pow(t,i)).toPrecision(3)+" "+sizes[i]},uuId:function(n,t){var u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[],i,f;if(t=t||u.length,n)for(i=0;i<n;i++)r[i]=u[0|Math.random()*t];else for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",i=0;i<36;i++)r[i]||(f=0|Math.random()*16,r[i]=u[i===19?f&3|8:f]);return r.join("")},guid:function(){function n(t){function f(n,t){if(t=t.replace(/\{|\(|\)|\}|-/g,""),t=t.toLowerCase(),t.length!==32||t.search(/[^0-9,a-f]/i)!==-1)u(n);else for(var i=0;i<t.length;i++)n.push(t[i])}function u(n){for(var t=32;t--;)n.push("0")}function r(t,i){var u;switch(i){case"N":return t.toString().replace(/,/g,"");case"D":return u=t.slice(0,8)+"-"+t.slice(8,12)+"-"+t.slice(12,16)+"-"+t.slice(16,20)+"-"+t.slice(20,32),u.replace(/,/g,"");case"B":return u=r(t,"D"),"{"+u+"}";case"P":return u=r(t,"D"),"("+u+")";default:return new n}}var i=[];typeof t=="string"?f(i,t):u(i);this.Equals=function(n){return n&&n.IsGuid?this.ToString()===n.ToString():!1};this.IsGuid=function(){};this.ToString=function(n){return typeof n=="string"?n==="N"||n==="D"||n==="B"||n==="P"?r(i,n):r(i,"D"):r(i,"D")}}function t(){for(var t="",i=32;i--;)t+=Math.floor(Math.random()*16).toString(16);return new n(t)}return t().ToString()},rmbToUpper:function(n){var l="零",a="元",u,r,t,e,s,v,y,p,o,i,h,f,w,c;if(n=n.toString(),n==="")return alert("Empty input!"),"";if(n.match(/[^,.\d]/)!==null)return alert("Invalid characters in the input string!"),"";if(n.match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/)===null)return alert("Illegal format of digit number!"),"";if(n=n.replace(/,/g,""),n=n.replace(/^0+/,""),Number(n)>99999999999.99)return alert("Too large a number to convert!"),"";if(e=n.split("."),e.length>1?(u=e[0],r=e[1],r=r.substr(0,2)):(u=e[0],r=""),s=[l,"壹","贰","叁","肆","伍","陆","柒","捌","玖"],v=["","拾","佰","仟"],y=["","万","亿"],p=["角","分"],t="",Number(u)>0){for(o=0,i=0;i<u.length;i++)h=u.length-i-1,f=u.substr(i,1),w=h/4,c=h%4,f==="0"?o++:(o>0&&(t+=s[0]),o=0,t+=s[Number(f)]+v[c]),c===0&&o<4&&(t+=y[w]);t+=a}if(r!=="")for(i=0;i<r.length;i++)f=r.substr(i,1),f!=="0"&&(t+=s[Number(f)]+p[i]);return t===""&&(t=l+a),r===""&&(t+="整"),""+t},randomColorCssClass:function(){var n=Number.random(0,_colors.length-1);return colors[n]}},u.states=[{color:"#fff","background-color":"#4C87B9"},{color:"#fff","background-color":"#3FABA4"},{color:"#fff","background-color":"#8877A9"},{color:"#fff","background-color":"#32c5d2"},{color:"#fff","background-color":"#D05454"},{color:"#fff","background-color":"#9A12B3"},{color:"#fff","background-color":"#4B77BE"},{color:"#fff","background-color":"#22313F"},{color:"#fff","background-color":"#C8D046"},{color:"#fff","background-color":"#F2784B"}],t.bindingHandlers.img={update:function(i,r){var u=t.utils.unwrapObservable(r());(u===""||u===undefined)&&(u="/assets/global/img/no-image.jpg");n(i).attr({src:u})}},t.bindingHandlers.dateFormat={init:function(i,r,u){var f=u(),e=t.utils.unwrapObservable(f.dateFormat),s=t.utils.unwrapObservable(f.text),o;typeof e=="string"&&(o=new Date(s).format(e),n(i).html(o))}},t.bindingHandlers.dateDiff={update:function(i,r){var u=t.utils.unwrapObservable(r()),f="";(u!==""||u!==undefined)&&(f=new Date(u).diff2());n(i).text(f)}},t.bindingHandlers.select2={init:function(t,i,r){var f=i(),u=r();setTimeout(function(){if(n(t).addClass("select2").select2(f),u.select2.multiple===!0)n(t).on("select2:opening select2:closing",function(){var t=n(this).select2("data"),i="";t.length>0&&(i=t.map(function(n){return n.id}).join(","));u.select2.value&&u.select2.value(i)})},0)},update:function(t,i,r){var e=i(),f=r(),u;f.select2.multiple===!0&&(u=f.select2.value()||"",u.length>0?n(t).val(u.split(",")):n(t).val([]));n(t).trigger("change")}},t.bindingHandlers.state={update:function(i,r){var f=t.utils.unwrapObservable(r()),e,o;f===undefined?n(i).text("无状态"):(e=f.Index,o=f.Name,n(i).text(o).css(u.states[e]));n(i).parent()[0].tagName.toLowerCase()==="td"&&n(i).parent().css({width:"1%","text-align":"center"})}},n.extend(String.prototype,{append:function(n){return this.concat(n)},removeAt:function(n){return n<0||n>=this.length?this.valueOf():n===0?this.substring(1,this.length):n===this.length-1?this.substring(0,this.length-1):this.substring(0,n)+this.substring(n+1)},removeAtScope:function(n,t){if(n===t)return this.deleteCharAt(n);if(n>t){var i=t;t=n;n=i}return n<0&&(n=0),t>this.length-1&&(t=this.length-1),this.substring(0,n+1)+this.substring(t,this.length)},equals:function(n){if(this.length!==n.length)return!1;for(var t=0;t<this.length;t++)if(this.charAt(t)!==n.charAt(t))return!1;return!0},equalsIgnoreCase:function(n){if(this.length!==n.length)return!1;var t=this.toLowerCase(),i=n.toLowerCase();return t.equals(i)},insert:function(n,t){return n<0||n>=this.length-1?this.append(t):this.substring(0,n+1)+t+this.substring(n+1)},setAt:function(n,t){return n<0||n>this.length-1?this.valueOf():this.substring(0,n)+t+this.substring(n+1)},trim:function(){return this.replace(/(^\s*)|(\s*$)/g,"")},trimLeft:function(){return this.replace(/^s+/g,"")},trimRight:function(){return this.replace(/s+$/g,"")},reverse:function(){return this.split("").reverse().join("")},resetBlank:function(){return this.replace(/\s+/g," ")},getNumber:function(){return this.replace(/[^\d]/g,"")},getCN:function(){return this.replace(/[^\u4e00-\u9fa5\uf900-\ufa2d]/g,"")},getEN:function(){return this.replace(/[^A-Za-z]/g,"")},toInt:function(){return isNaN(parseInt(this))?this.toString():parseInt(this)},toFloat:function(){return isNaN(parseFloat(this))?this.toString():parseFloat(this)},toCharArray:function(){return this.split("")},toJson:function(){return JSON.parse(this)},getRealLength:function(){var n,t;return/^[\u4e00-\u9fa5\uf900-\ufa2d]+$/.test(this)?this.length*2:(n=this.match(/[\0x00-\xff]/g),t=this.length*2-n.length,t)},left:function(n){return this.slice(0,n)},right:function(n){return this.slice(this.length-n)},htmlEncode:function(){for(var t=this,i=[/x26/g,/x3C/g,/x3E/g,/x20/g],r=["&","<",">"," "],n=0;n<i.length;n++)t=t.replace(i[n],r[n]);return t},ascW:function(){for(var t="",n=0;n<this.length;n++)t+="&#"+this.charCodeAt(n)+";";return t},getFileName:function(){return this.replace(/^.*\/([^\/\?]*).*$/,"$1")},getExtensionName:function(){return this.replace(/^.*\/[^\/]*(\.[^\.\?]*).*$/,"$1")},replaceAll:function(n,t){return this.replace(new RegExp(n,"gm"),t)},isPositiveInteger:function(){return new RegExp(/^[1-9]\d*$/).test(this)},isInteger:function(){return new RegExp(/^\d+$/).test(this)},isNumber:function(){return new RegExp(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/).test(this)},startsWith:function(n){return this.indexOf(n)===0},endsWith:function(n){var t=this.length-n.length;return t>=0&&this.lastIndexOf(n)===t},isValidPwd:function(){return new RegExp(/^([_]|[a-zA-Z0-9]){6,32}$/).test(this)},isValidMail:function(){return new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/).test(this.trim())},isPhone:function(){return new RegExp(/(^([0-9]{3,4}[-])?\d{3,8}(-\d{1,6})?$)|(^\([0-9]{3,4}\)\d{3,8}(\(\d{1,6}\))?$)|(^\d{3,8}$)/).test(this)},isUrl:function(){return new RegExp(/^[a-zA-z]+:\/\/([a-zA-Z0-9\-\.]+)([-\w .\/?%&=:]*)$/).test(this)},isExternalUrl:function(){return this.isUrl()&&this.indexOf("://"+document.domain)===-1},getUrlParm:function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+n+"=([^&#]*)",r=new RegExp(i),t=r.exec(this);return t===null?"":t[1]},appendUrlParm:function(n){var t=this,i,r,f,u;if(typeof n=="string")t=t+"?"+n;else{i=[];for(r in n)f=n[r],i.push("&"+r+"="+f);u="";i.length>0&&(u=i.join("").substr(1),t=t+"?"+u)}return t.replace(" ","")}}),n.extend(String,{format:function(){if(arguments.length===0)return"";if(arguments.length===1)return arguments[0];var n=arguments;return arguments[0].replace(/{(\d+)?}/g,function(t,i){return n[parseInt(i)+1]})}}),n.extend(Number.prototype,{zeroPadding:function(n){for(var t=this.toString();t.length<n;)t="0"+t;return t}}),n.extend(Number,{random:function(n,t){var i=t-n,r=Math.random();return n+Math.round(r*i)}}),n.extend(Array.prototype,{maxToMin:function(){for(var t,i,n=0;n<this.length;n++)for(t=0;t<=n;t++)this[n]>this[t]&&(i=this[n],this[n]=this[t],this[t]=i);return this},minToMax:function(){for(var t,i,n=0;n<this.length;n++)for(t=0;t<=n;t++)this[n]<this[t]&&(i=this[n],this[n]=this[t],this[t]=i);return this},getMax:function(){for(var t=0,n=0;n<this.length;n++)this[n]>t&&(t=this[n]);return t},getMin:function(){for(var t=0,n=0;n<this.length;n++)this[n]<t&&(t=this[n]);return t},pushRange:function(n){var i=n.length,t;if(i!==0)for(t=0;t<i;t++)this.push(n[t])},clear:function(){this.length>0&&this.splice(0,this.length)},isEmpty:function(){return this.length===0?!0:!1},clone:function(){for(var t=[],i=this.length,n=0;n<i;n++)t[n]=this[n];return t},contains:function(n){var t=this.indexOf(n);return t>=0},indexOf:function(n){var i=this.length,t;if(i!==0)for(t=0;t<i;t++)if(this[t]===n)return t;return-1},insert:function(n,t){this.splice(n,0,t)},joinstr:function(n){for(var i=new Array(this.length),t=0;t<this.length;t++)i[t]=this[t]+n;return i},remove:function(n){var t=this.indexOf(n);t>=0&&this.splice(t,1)},removeAt:function(n){this.splice(n,1)},each:function(n){var i,u,t,r;for(n=n||Function.K,i=[],u=Array.prototype.slice.call(arguments,1),t=0;t<this.length;t++)r=n.apply(this,[this[t],t].concat(u)),r!==null&&i.push(r);return i},uniquelize:function(){for(var t=[],n=0;n<this.length;n++)t.contains(this[n])||t.push(this[n]);return t}}),n.extend(Array,{complement:function(n,t){return Array.minus(Array.union(n,t),Array.intersect(n,t))},intersect:function(n,t){return n.uniquelize().each(function(n){return t.contains(n)?n:null})},minus:function(n,t){return n.uniquelize().each(function(n){return t.contains(n)?null:n})},union:function(n,t){return n.concat(t).uniquelize()}}),n.extend(Date.prototype,{format:function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));/(E+)/.test(n)&&(n=n.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"星期":"周":"")+{"0":"日","1":"一","2":"二","3":"三","4":"四","5":"五","6":"六"}[this.getDay()+""]));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n},diff:function(n,t){if(arguments.length<2||t.constructor!==Date)return undefined;switch(n){case"s":return parseInt((t-this)/1e3);case"n":return parseInt((t-this)/6e4);case"h":return parseInt((t-this)/36e5);case"d":return parseInt((t-this)/864e5);case"w":return parseInt((t-this)/6048e5);case"m":return t.getMonth()+1+(t.getFullYear()-this.getFullYear())*12-(this.getMonth()+1);case"y":return t.getFullYear()-this.getFullYear();default:return undefined}},diff2:function(){var h=this.getTime(),i=6e4,r=i*60,t=r*24,a=t*15,c=t*30,l=(new Date).getTime(),n=l-h;if(!(n<0)){var u=n/c,f=n/(7*t),e=n/t,o=n/r,s=n/i;return result=u>=1?""+parseInt(u)+"月前":f>=1?""+parseInt(f)+"周前":e>=1?""+parseInt(e)+"天前":o>=1?""+parseInt(o)+"小时前":s>=1?""+parseInt(s)+"分钟前":"刚刚"}},add:function(n,t){var i=this;switch(n){case"s":return new Date(Date.parse(i)+1e3*t);case"n":return new Date(Date.parse(i)+6e4*t);case"h":return new Date(Date.parse(i)+36e5*t);case"d":return new Date(Date.parse(i)+864e5*t);case"w":return new Date(Date.parse(i)+6048e5*t);case"q":return new Date(i.getFullYear(),i.getMonth()+t*3,i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds());case"m":return new Date(i.getFullYear(),i.getMonth()+t,i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds());case"y":return new Date(i.getFullYear()+t,i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds())}}}),u});